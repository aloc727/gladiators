<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gladiators Clan War Stats</title>
    <link rel="icon" type="image/png" href="/favicon.png?v=1">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Slab:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">
                <img src="/logo-cr.jpg?v=1" alt="Clash Royale logo" class="brand-logo" onerror="this.src='/favicon.png?v=1'">
                <div class="brand-text">
                    <h1>Gladiators Clan War Stats</h1>
                    <p class="clan-tag">Clan Tag: #2CPPJLJ</p>
                </div>
            </div>
            <p class="last-updated" id="lastUpdated">Updated as of: --</p>
        </header>

        <div class="menu-bar">
            <button class="menu-toggle" id="menuToggle" aria-label="Open menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="menu-tabs" id="menuTabs">
                <button class="menu-tab active" data-tab="table" data-route="/">War Table</button>
                <button class="menu-tab" data-tab="summary" data-route="/summary">Summary</button>
                <button class="menu-tab" data-tab="players" data-route="/players">Players</button>
            </nav>
        </div>

        <section class="tab-panel active" id="tab-table">
            <div class="legend">
                <span class="legend-item legend-green">1600+ (On Track)</span>
                <span class="legend-item legend-yellow">800 - 1599 (Needs Nudge)</span>
                <span class="legend-item legend-red">0 - 799 (At Risk)</span>
                <span class="legend-item legend-na">N/A (New This Week)</span>
            </div>

            <section class="home-cards">
                <div class="dashboard-card" id="promotionBoard"></div>
                <div class="dashboard-card" id="demotionBoard"></div>
            </section>

            <div class="tabs">
                <button class="range-tab active" data-range="recent">Recent (Last 2 Months)</button>
                <button class="range-tab" data-range="all">All Time</button>
                <label class="member-toggle">
                    <input type="checkbox" id="currentMembersOnly" checked>
                    Show current members only
                </label>
            </div>
            
            <div class="controls">
                <div class="loading" id="loading" style="display: none;">Loading...</div>
                <span class="next-refresh" id="nextRefresh">Next refresh in: --</span>
            </div>
            
            <div class="table-container" id="tableView">
                <table id="statsTable">
                    <thead id="tableHead">
                        <tr>
                            <th class="sortable" data-column="player">Player Name</th>
                            <!-- Week columns will be dynamically added here -->
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be dynamically added here -->
                    </tbody>
                </table>
            </div>
            
            <div id="errorMessage" class="error" style="display: none;"></div>
        </section>

        <section class="tab-panel" id="tab-summary">
            <section class="highlights" id="highlights"></section>

            <section class="dashboard">
                <div class="dashboard-card" id="clanStats"></div>
                <div class="dashboard-card" id="strategyBoard"></div>
            </section>

            <section class="info-section">
                <div class="info-card">
                    <h3>How This Updates</h3>
                <p>The site auto-refreshes every 5 minutes and shows the latest war points. Clan wars run Thursday through Monday and end Monday at 4:30am CT.</p>
                </div>
                <div class="info-card">
                    <h3>Data Source</h3>
                    <p>Official Clash Royale API. While the war log endpoint is down, we use the current river race data and build history locally.</p>
                </div>
                <div class="info-card">
                    <h3>War Requirements</h3>
                    <p>Weekly requirement is <strong>1600</strong>. New members show <strong>N/A</strong> for past weeks; non-participation shows <strong>0</strong>.</p>
                </div>
            </section>
        </section>

        <section class="tab-panel" id="tab-players">
            <section class="summary-tables">
                <div class="summary-card">
                    <h3>Top Performers (Current Week)</h3>
                    <div class="summary-table" id="topPerformersTable"></div>
                </div>
                <div class="summary-card">
                    <h3>Most Improved (Last Week)</h3>
                    <div class="summary-table" id="improvementTable"></div>
                </div>
                <div class="summary-card">
                    <h3>Leaderboard (Last 3 Months)</h3>
                    <div class="summary-table" id="leaderboardTable"></div>
                </div>
            </section>
        </section>

        <footer class="site-footer">
            <span class="version-tag" id="uiVersion">UI v1.9.0</span>
        </footer>
    </div>
    
    <script src="app.js"></script>
</body>
</html>
